<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Register</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="styles.css" rel="stylesheet">
<script defer src="app.js"></script>
</head><body class="p-3">
<nav class="navbar navbar-expand-lg bg-light">
  <div class="container">
    <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="index.html">
  <img src="image.png" alt="Swarnika Logo" class="brand-logo">
  <span>Swarnika Jewels</span>
</a>
    <div class="ms-auto d-flex align-items-center gap-2">
      <div id="navAuth"><a class="btn btn-outline-primary" href="login.html">Login</a></div>
      <div id="navUser"></div>
      <a id="cartBtn" class="btn btn-primary" href="cart.html">Cart <span class="cart-count"></span></a>
    </div>
  </div>
</nav>
<div class="container col-md-4">
  <h3>Register</h3>
  <div id="msg" class="text-danger"></div>
  <div class="mb-3"><input id="name" class="form-control" placeholder="Full Name" required></div>
  <div class="mb-3"><input id="email" type="email" class="form-control" placeholder="Email Address" required></div>
  <div class="mb-3"><input id="phone" type="tel" class="form-control" placeholder="Mobile Number" required></div>
  <div class="mb-3"><input id="pass" type="password" class="form-control" placeholder="Password" required></div>
  <button id="btn" class="btn btn-primary w-100">Register</button>
  <p class="mt-3">Already? <a href="login.html">Login</a></p>
</div>

<script>
const API = 'http://localhost:4000/api';

// Safely call redirectIfLoggedIn if defined elsewhere
if (typeof redirectIfLoggedIn === "function") {
  redirectIfLoggedIn();
}
if (typeof setupNavbar === "function") {
  setupNavbar();
}

document.getElementById('btn').addEventListener('click', async ()=>{
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const password = document.getElementById('pass').value.trim();
  const msg = document.getElementById('msg');
  msg.classList.remove('text-success');
  msg.classList.add('text-danger');

  if (!name || !email || !password || !phone) {
    msg.innerText = "âš ï¸ Please fill in all fields";
    return;
  }

  msg.innerText = "â³ Registering...";

  try {
    const res = await fetch(`${API}/auth/register`, {
      method: 'POST',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, email, password, phone })
    });

    const text = await res.text();
    let data;
    try {
      data = JSON.parse(text);
    } catch {
      console.error('Unexpected non-JSON response:', text.slice(0, 200));
      throw new Error('Server did not return valid JSON. Check backend /api/auth/register route.');
    }

    if (!res.ok) {
      msg.innerText = `âŒ ${data?.error || 'Registration failed'}`;
      return;
    }

    msg.classList.remove('text-danger');
    msg.classList.add('text-success');
    msg.innerText = "âœ… Registered successfully! Redirecting...";
    setTimeout(() => location.href = 'index.html', 1000);

  } catch (err) {
    msg.innerText = `ðŸš« Network error: ${err.message}`;
    console.error('Registration error:', err);
  }
});
</script>
</body></html>