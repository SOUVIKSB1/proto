<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Login</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="styles.css" rel="stylesheet">
<script defer src="app.js"></script>
</head><body class="p-3">
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="index.html">
  <img src="image.png" alt="Swarnika Logo" class="brand-logo">
  <span>Swarnika Jewels</span>
</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav align-items-center gap-2">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="orders.html">Orders</a></li>
        <li class="nav-item">
          <a id="cartBtn" class="btn btn-primary position-relative" href="login.html">
            Log in
            <span class="cart-count position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"></span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<br>
<div class="container col-md-4">
  <h3><b>Login</b></h3>
  <div id="msg" class="text-danger"></div>
  <div class="mb-3"><input id="email" class="form-control" placeholder="Email"></div>
  <div class="mb-3"><input id="pass" type="password" class="form-control" placeholder="Password"></div>
  <button id="btn" class="btn btn-primary">Login</button>
  <p class="mt-3">New? <a href="register.html">Register</a></p>
</div>

<script>
const API = 'http://localhost:4000/api';

// Safely call redirectIfLoggedIn if defined elsewhere
if (typeof redirectIfLoggedIn === "function") {
  redirectIfLoggedIn();
}

if (typeof setupNavbar === "function") {
  setupNavbar();
}

document.getElementById('btn').addEventListener('click', async ()=>{
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('pass').value.trim();
  const msg = document.getElementById('msg');
  msg.classList.remove('text-success');
  msg.classList.add('text-danger');

  if (!email || !password) {
    msg.innerText = "âš ï¸ Please fill in both fields";
    return;
  }

  msg.innerText = "â³ Logging in...";

  try {
    const res = await fetch(`${API}/auth/login`, {
      method: 'POST',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });

    const text = await res.text();
    let data;
    try {
      data = JSON.parse(text);
    } catch {
      console.error('Unexpected non-JSON response:', text.slice(0, 200));
      throw new Error('Server did not return valid JSON. Check backend /api/auth/login route.');
    }

    if (!res.ok) {
      msg.innerText = `âŒ ${data?.error || 'Login failed'}`;
      return;
    }

    msg.classList.remove('text-danger');
    msg.classList.add('text-success');
    msg.innerText = "âœ… Login successful! Redirecting...";
    setTimeout(() => location.href = 'index.html', 1000);

  } catch (err) {
    msg.innerText = `ðŸš« Network error: ${err.message}`;
    console.error('Login error:', err);
  }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body></html>